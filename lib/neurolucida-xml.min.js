(function(){var a,b,c;b=function(){function a(a,b){this.startPoint=a,this.endPoint=b,this.direction=[this.endPoint[0]-this.startPoint[0],this.endPoint[1]-this.startPoint[1],this.endPoint[2]-this.startPoint[2]]}return a.prototype.getLength=function(){var a,b,c;return a=Math.pow(this.endPoint[0]-this.startPoint[0],2),b=Math.pow(this.endPoint[1]-this.startPoint[1],2),c=Math.pow(this.endPoint[2]-this.startPoint[2],2),Math.sqrt(a+b+c)},a.prototype.getVolume=function(){var a,b,c;return a=Math.pow(this.startPoint[3]/2,2),b=Math.pow(this.endPoint[3]/2,2),c=this.startPoint[3]*this.endPoint[3]/4,Math.PI*this.getLength()/3*(a+b+c)},a.prototype.getSurface=function(){var a,b,c;return b=this.startPoint[3]/2,c=this.endPoint[3]/2,a=Math.sqrt(Math.pow(b-c,2)+Math.pow(this.getLength(),2)),(b+c)*a*Math.PI},a.prototype.getDiameter=function(){return(this.startPoint[3]+this.endPoint[3])/2},a.prototype.distanceToPoint=function(a){var b,c,d;return d=[a[0]-this.startPoint[0],a[1]-this.startPoint[1],a[2]-this.startPoint[2]],b=[this.direction[1]*d[2]-this.direction[2]*d[1],this.direction[2]*d[0]-this.direction[0]*d[2],this.direction[0]*d[1]-this.direction[1]*d[0]],b=Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)),c=Math.sqrt(Math.pow(this.direction[0],2)+Math.pow(this.direction[1],2)+Math.pow(this.direction[2],2)),b/c},a}(),a=function(){function a(){this.dendrites=[]}return a.prototype.load=function(a){if(!a)throw new Error("No XML found");if(this.xml=$($.parseXML(a)))return this.loadDendrites(this.xml.find("tree[type=Dendrite]")),{dendrites:this.dendrites};throw new Error("Incorrect XML: "+a)},a.prototype.loadDendrites=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(this.loadDendrite($(b)));return e},a.prototype.loadDendrite=function(a){var c,d,e,f,g,h,i,j,k,l,m,n,o;for(c={spines:[],length:0,total_spines:0,surface:0,volume:0,diameter:0,group:"",file:"",title:""},n=a.children("point"),j=0,l=n.length;l>j;j++)f=n[j],e=$(f).nextAll("point").first(),e.length>0&&(g=new b(this._getCoordinates($(f)),this._getCoordinates(e)),c.length+=g.getLength(),c.volume+=g.getVolume(),c.surface+=g.getSurface(),c.diameter+=g.getDiameter());for(c.diameter/=a.children("point").length-1,o=a.children("spine"),k=0,m=o.length;m>k;k++)h=o[k],i=this._getCoordinates($(h).prev("point")),d=this._getCoordinates($(h).children("point").first()),h=new b(i,d),c.spines.push({length:h.getLength()}),c.total_spines++;return this.dendrites.push(c)},a.prototype._getCoordinates=function(a){return[parseFloat(a.attr("x")),parseFloat(a.attr("y")),parseFloat(a.attr("z")),parseFloat(a.attr("d"))]},a}(),c="undefined"!=typeof exports&&null!==exports?exports:window,c.NeurolucidaXML=a}).call(this);